use anvil::{spawn, NodeConfig};
use ethers::signers::{LocalWallet, Signer};
use std::sync::Arc;
use webb::evm::contract::protocol_solidity::FungibleTokenWrapperContract;
use webb::evm::ethers::abi::Token;
use webb::evm::ethers::contract::abigen;
use webb::evm::ethers::contract::ContractFactory;
use webb::evm::ethers::core::rand::thread_rng;
use webb::evm::ethers::middleware::SignerMiddleware;
use webb::evm::ethers::providers::{Middleware, Provider};
use webb::evm::ethers::types::Bytes;
use webb::evm::ethers::utils::parse_ether;
use webb_relayer_config::cli::{create_store, Opts};
use webb_relayer_config::WebbRelayerConfig;
use webb_relayer_context::RelayerContext;

//abigen!(FungibleTokenWrapperContract,"assets/FungibleTokenWrapperContract.json");

#[tokio::test]
async fn test_vanchor() {
    let governor_wallet = LocalWallet::new(&mut thread_rng());
    let relayer_wallet = LocalWallet::new(&mut thread_rng());
    let node_config = NodeConfig {
        genesis_accounts: vec![governor_wallet.clone(), relayer_wallet.clone()],
        genesis_balance: parse_ether(100000).unwrap(),
        enable_tracing: false,
        gas_limit: parse_ether(10).unwrap(),
        gas_price: Some(100.into()),
        disable_block_gas_limit: true,
        port: 0,
        ..Default::default()
    };
    let chain_one = spawn(node_config.clone()).await;
    let chain_two = spawn(node_config).await;

    let provider = Arc::new(
        Provider::try_from(chain_one.1.http_endpoint().as_str()).unwrap(),
    );
    dbg!(provider.get_balance(governor_wallet.address(), None).await.unwrap());

    // TODO: could use abigen (also not working)
    //let client = Arc::new(SignerMiddleware::new(provider, governor_wallet.into()));
    //let token_one = FungibleTokenWrapperContract::new(governor_wallet.address(), client.clone(), ).unwrap().send().await.unwrap();

    let token_one = FungibleTokenWrapperContract::new(
        governor_wallet.address(),
        provider.clone(),
    );
    //token_one.increase_allowance(governor_wallet.address(), parse_ether(1).unwrap()).await.unwrap();
    let bytecode: Bytes = "60806040523480156200001157600080fd5b50604051620042ef380380620042ef833981016040819052620000349162000390565b81818181818181600690805190602001906200005292919062000233565b5080516200006890600790602084019062000233565b50506008805460ff191690555062000082600033620000e6565b620000ae7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a633620000e6565b620000da7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a33620000e6565b5050505050506200044d565b620000f28282620000f6565b5050565b6200010d82826200013960201b620026d31760201c565b6000828152600260209081526040909120620001349183906200273e620001c1821b17901c565b505050565b60008281526001602090815260408083206001600160a01b038516845290915290205460ff16620000f25760008281526001602081815260408084206001600160a01b0386168086529252808420805460ff19169093179092559051339285917f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d9190a45050565b6000620001d8836001600160a01b038416620001e1565b90505b92915050565b60008181526001830160205260408120546200022a57508154600181810184556000848152602080822090930184905584548482528286019093526040902091909155620001db565b506000620001db565b8280546200024190620003fa565b90600052602060002090601f016020900481019282620002655760008555620002b0565b82601f106200028057805160ff1916838001178555620002b0565b82800160010185558215620002b0579182015b82811115620002b057825182559160200191906001019062000293565b50620002be929150620002c2565b5090565b5b80821115620002be5760008155600101620002c3565b600082601f830112620002eb57600080fd5b81516001600160401b038082111562000308576200030862000437565b604051601f8301601f19908116603f0116810190828211818310171562000333576200033362000437565b816040528381526020925086838588010111156200035057600080fd5b600091505b8382101562000374578582018301518183018401529082019062000355565b83821115620003865760008385830101525b9695505050505050565b60008060408385031215620003a457600080fd5b82516001600160401b0380821115620003bc57600080fd5b620003ca86838701620002d9565b93506020850151915080821115620003e157600080fd5b50620003f085828601620002d9565b9150509250929050565b600181811c908216806200040f57607f821691505b602082108114156200043157634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052604160045260246000fd5b613e92806200045d6000396000f3fe6080604052600436106103765760003560e01c80638456cb59116101d1578063bac426d011610102578063ced72f87116100a0578063e63ab1e91161006f578063e63ab1e914610a04578063f63ebb4514610a26578063fae0959a14610a46578063fc97a65214610a6657600080fd5b8063ced72f8714610984578063d5391393146109a2578063d547741f146109c4578063dd62ed3e146109e457600080fd5b8063c2ae4720116100dc578063c2ae47201461090e578063c80916d41461092e578063ca15c8731461094e578063cc3c74a11461096e57600080fd5b8063bac426d0146108bb578063bf376c7a146108db578063c1876453146108ee57600080fd5b806396cd4dfe1161016f578063a457c2d711610149578063a457c2d71461083f578063a9059cbb1461085f578063aa6ca8081461087f578063b3e4083f146108a157600080fd5b806396cd4dfe146107d7578063a001ecdd146107f7578063a217fddf1461082a57600080fd5b80638b5478b9116101ab5780638b5478b9146107625780639010d07c1461078257806391d14854146107a257806395d89b41146107c257600080fd5b80638456cb591461070d57806385c00ae81461072257806385d148341461074257600080fd5b8063313ce567116102ab57806346904840116102495780635c975abb116102235780635c975abb1461068c57806370a08231146106a457806379cc6790146106da5780637b2e30d6146106fa57600080fd5b8063469048401461060d5780634808285e1461064c5780634f64b2be1461066c57600080fd5b806339f476931161028557806339f47693146105985780633f4ba83a146105b857806340c10f19146105cd57806342966c68146105ed57600080fd5b8063313ce5671461053c57806336568abe14610558578063395093511461057857600080fd5b80631c4a143611610318578063248a9ca3116102f2578063248a9ca3146104b8578063261c80b6146104e95780632ca69388146105095780632f2ff15d1461051c57600080fd5b80631c4a1436146104625780631f9143821461048257806323b872dd1461049857600080fd5b8063095ea7b311610354578063095ea7b3146103f45780630b27fb9a14610414578063158ef93e1461043357806318160ddd1461044d57600080fd5b806301ffc9a71461037b57806306fdde03146103b057806307184f1c146103d2575b600080fd5b34801561038757600080fd5b5061039b6103963660046136b5565b610a86565b60405190151581526020015b60405180910390f35b3480156103bc57600080fd5b506103c5610ab1565b6040516103a79190613871565b3480156103de57600080fd5b506103f26103ed3660046134ab565b610b43565b005b34801561040057600080fd5b5061039b61040f3660046135ad565b610c7a565b34801561042057600080fd5b506009545b6040519081526020016103a7565b34801561043f57600080fd5b5060005461039b9060ff1681565b34801561045957600080fd5b50600554610425565b34801561046e57600080fd5b506103f261047d3660046134ab565b610c92565b34801561048e57600080fd5b5061042560105481565b3480156104a457600080fd5b5061039b6104b3366004613519565b610e81565b3480156104c457600080fd5b506104256104d3366004613655565b6000908152600160208190526040909120015490565b3480156104f557600080fd5b506103f2610504366004613519565b610ea5565b6103f2610517366004613519565b6110df565b34801561052857600080fd5b506103f261053736600461366e565b6113e1565b34801561054857600080fd5b50604051601281526020016103a7565b34801561056457600080fd5b506103f261057336600461366e565b61140c565b34801561058457600080fd5b5061039b6105933660046135ad565b61148a565b3480156105a457600080fd5b506103f26105b33660046135ad565b6114ac565b3480156105c457600080fd5b506103f26116ad565b3480156105d957600080fd5b506103f26105e83660046135ad565b61172f565b3480156105f957600080fd5b506103f2610608366004613655565b6117aa565b34801561061957600080fd5b5060085461063490630100000090046001600160a01b031681565b6040516001600160a01b0390911681526020016103a7565b34801561065857600080fd5b506103f26106673660046135d9565b6117b7565b34801561067857600080fd5b50610634610687366004613655565b611960565b34801561069857600080fd5b5060085460ff1661039b565b3480156106b057600080fd5b506104256106bf36600461348e565b6001600160a01b031660009081526003602052604090205490565b3480156106e657600080fd5b506103f26106f53660046135ad565b61198a565b6103f261070836600461355a565b61199f565b34801561071957600080fd5b506103f2611c9c565b34801561072e57600080fd5b5061042561073d366004613655565b611d1c565b34801561074e57600080fd5b5061063461075d366004613655565b611d44565b34801561076e57600080fd5b506103f261077d36600461361b565b611d54565b34801561078e57600080fd5b5061063461079d366004613693565b611d91565b3480156107ae57600080fd5b5061039b6107bd36600461366e565b611db0565b3480156107ce57600080fd5b506103c5611ddb565b3480156107e357600080fd5b506104256107f2366004613655565b611dea565b34801561080357600080fd5b5060085461081790610100900461ffff1681565b60405161ffff90911681526020016103a7565b34801561083657600080fd5b50610425600081565b34801561084b57600080fd5b5061039b61085a3660046135ad565b611e19565b34801561086b57600080fd5b5061039b61087a3660046135ad565b611e94565b34801561088b57600080fd5b50610894611ea2565b6040516103a79190613824565b3480156108ad57600080fd5b50600f5461039b9060ff1681565b3480156108c757600080fd5b506103f26108d636600461348e565b611f03565b6103f26108e93660046135ad565b611f4f565b3480156108fa57600080fd5b5061039b61090936600461348e565b61221f565b34801561091a57600080fd5b506103f2610929366004613756565b612260565b34801561093a57600080fd5b50600a54610634906001600160a01b031681565b34801561095a57600080fd5b50610425610969366004613655565b61236f565b34801561097a57600080fd5b5061042560095481565b34801561099057600080fd5b50600854610100900461ffff16610817565b3480156109ae57600080fd5b50610425600080516020613e3d83398151915281565b3480156109d057600080fd5b506103f26109df36600461366e565b612386565b3480156109f057600080fd5b506104256109ff3660046134e0565b6123ac565b348015610a1057600080fd5b50610425600080516020613e1d83398151915281565b348015610a3257600080fd5b506103f2610a413660046136df565b6123d7565b348015610a5257600080fd5b506103f2610a61366004613655565b6124b6565b348015610a7257600080fd5b506103f2610a813660046134ab565b6124e5565b60006001600160e01b03198216635a05180f60e01b1480610aab5750610aab82612753565b92915050565b606060068054610ac090613d2b565b80601f0160208091040260200160405190810160405280929190818152602001828054610aec90613d2b565b8015610b395780601f10610b0e57610100808354040283529160200191610b39565b820191906000526020600020905b815481529060010190602001808311610b1c57829003601f168201915b5050505050905090565b600a546001600160a01b03163314610b765760405162461bcd60e51b8152600401610b6d90613b1f565b60405180910390fd5b8063ffffffff168060095410610b9e5760405162461bcd60e51b8152600401610b6d906138ef565b600954610bac906001613c55565b811115610bcb5760405162461bcd60e51b8152600401610b6d9061399e565b60098190556001600160a01b038316610c4c5760405162461bcd60e51b815260206004820152603a60248201527f46756e6769626c65546f6b656e577261707065723a204665652052656369706960448201527f656e742063616e6e6f74206265207a65726f20616464726573730000000000006064820152608401610b6d565b5050600880546001600160a01b039092166301000000026301000000600160b81b0319909216919091179055565b600033610c88818585612788565b5060019392505050565b600a546001600160a01b03163314610cbc5760405162461bcd60e51b8152600401610b6d90613b1f565b8063ffffffff168060095410610ce45760405162461bcd60e51b8152600401610b6d906138ef565b600954610cf2906001613c55565b811115610d115760405162461bcd60e51b8152600401610b6d9061399e565b60098190556001600160a01b0383166000908152600d602052604090205460ff16610d925760405162461bcd60e51b815260206004820152602b60248201527f46756e6769626c65546f6b656e577261707065723a20546f6b656e2073686f7560448201526a1b19081899481d985b1a5960aa1b6064820152608401610b6d565b6000805b600b54811015610df257846001600160a01b0316600b8281548110610dbd57610dbd613dad565b6000918252602090912001546001600160a01b03161415610de057809150610df2565b80610dea81613d66565b915050610d96565b50600b548110610e525760405162461bcd60e51b815260206004820152602560248201527f46756e6769626c65546f6b656e577261707065723a20546f6b656e206e6f7420604482015264199bdd5b9960da1b6064820152608401610b6d565b6001600160a01b0384166000908152600d60205260409020805460ff19169055610e7b816128ac565b50505050565b600033610e8f85828561295c565b610e9a8585856129d0565b506001949350505050565b610ebd600080516020613e3d83398151915233611db0565b610ed95760405162461bcd60e51b8152600401610b6d90613c19565b81816001600160a01b038216610f305780471015610f095760405162461bcd60e51b8152600401610b6d90613932565b600f5460ff16610f2b5760405162461bcd60e51b8152600401610b6d90613a7e565b610fff565b6040516370a0823160e01b815230600482015281906001600160a01b038416906370a082319060240160206040518083038186803b158015610f7157600080fd5b505afa158015610f85573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610fa99190613772565b1015610fc75760405162461bcd60e51b8152600401610b6d90613bab565b6001600160a01b0382166000908152600e602052604090205460ff16610fff5760405162461bcd60e51b8152600401610b6d90613969565b6110098584612b86565b6001600160a01b038416611053576040516001600160a01b0386169084156108fc029085906000818181858888f1935050505015801561104d573d6000803e3d6000fd5b506110d8565b60405163a9059cbb60e01b81526001600160a01b0386811660048301526024820185905285169063a9059cbb906044015b602060405180830381600087803b15801561109e57600080fd5b505af11580156110b2573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110d69190613638565b505b5050505050565b6110f7600080516020613e3d83398151915233611db0565b6111135760405162461bcd60e51b8152600401610b6d90613c19565b60085482906001600160a01b036301000000909104811690839083166111785780156111515760405162461bcd60e51b8152600401610b6d906138a4565b600f5460ff166111735760405162461bcd60e51b8152600401610b6d90613a29565b6111ce565b34156111965760405162461bcd60e51b8152600401610b6d90613be2565b6001600160a01b0383166000908152600d602052604090205460ff166111ce5760405162461bcd60e51b8152600401610b6d90613b7c565b6001600160a01b0382166111f45760405162461bcd60e51b8152600401610b6d90613adb565b6111fd81612cc6565b6112195760405162461bcd60e51b8152600401610b6d906139fb565b60006112396001600160a01b038716156112335785611d1c565b34611d1c565b905060006001600160a01b0387161561125b576112568683612d4e565b611265565b6112653483612d4e565b90506001600160a01b0387166112bb5760085460405163010000009091046001600160a01b0316906108fc8415029084906000818181858888f193505050501580156112b5573d6000803e3d6000fd5b506113cd565b6040516323b872dd60e01b81526001600160a01b038816906323b872dd906112eb908b9030908690600401613800565b602060405180830381600087803b15801561130557600080fd5b505af1158015611319573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061133d9190613638565b506008546040516323b872dd60e01b81526001600160a01b03808a16926323b872dd92611379928d926301000000900416908790600401613800565b602060405180830381600087803b15801561139357600080fd5b505af11580156113a7573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906113cb9190613638565b505b6113d78882612d5a565b5050505050505050565b600082815260016020819052604090912001546113fd81612e27565b6114078383612e31565b505050565b6001600160a01b038116331461147c5760405162461bcd60e51b815260206004820152602f60248201527f416363657373436f6e74726f6c3a2063616e206f6e6c792072656e6f756e636560448201526e103937b632b9903337b91039b2b63360891b6064820152608401610b6d565b6114868282612e53565b5050565b600033610c8881858561149d83836123ac565b6114a79190613c55565b612788565b81816001600160a01b03821661150357804710156114dc5760405162461bcd60e51b8152600401610b6d90613932565b600f5460ff166114fe5760405162461bcd60e51b8152600401610b6d90613a7e565b6115d2565b6040516370a0823160e01b815230600482015281906001600160a01b038416906370a082319060240160206040518083038186803b15801561154457600080fd5b505afa158015611558573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061157c9190613772565b101561159a5760405162461bcd60e51b8152600401610b6d90613bab565b6001600160a01b0382166000908152600e602052604090205460ff166115d25760405162461bcd60e51b8152600401610b6d90613969565b6115dc3384612b86565b6001600160a01b03841661161d57604051339084156108fc029085906000818181858888f19350505050158015611617573d6000803e3d6000fd5b50610e7b565b6001600160a01b03841663a9059cbb336040516001600160e01b031960e084901b1681526001600160a01b03909116600482015260248101869052604401602060405180830381600087803b15801561167557600080fd5b505af1158015611689573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110d89190613638565b6116c5600080516020613e1d83398151915233611db0565b6117255760405162461bcd60e51b81526020600482015260396024820152600080516020613dfd83398151915260448201527f76652070617573657220726f6c6520746f20756e7061757365000000000000006064820152608401610b6d565b61172d612e75565b565b611747600080516020613e3d83398151915233611db0565b6117a05760405162461bcd60e51b81526020600482015260366024820152600080516020613dfd8339815191526044820152751d99481b5a5b9d195c881c9bdb19481d1bc81b5a5b9d60521b6064820152608401610b6d565b6114868282612d5a565b6117b43382612b86565b50565b82826001600160a01b03821661180e57804710156117e75760405162461bcd60e51b8152600401610b6d90613932565b600f5460ff166118095760405162461bcd60e51b8152600401610b6d90613a7e565b6118dd565b6040516370a0823160e01b815230600482015281906001600160a01b038416906370a082319060240160206040518083038186803b15801561184f57600080fd5b505afa158015611863573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906118879190613772565b10156118a55760405162461bcd60e51b8152600401610b6d90613bab565b6001600160a01b0382166000908152600e602052604090205460ff166118dd5760405162461bcd60e51b8152600401610b6d90613969565b6118e73385612b86565b6001600160a01b03851661192b576040516001600160a01b0384169085156108fc029086906000818181858888f1935050505015801561104d573d6000803e3d6000fd5b60405163a9059cbb60e01b81526001600160a01b0384811660048301526024820186905286169063a9059cbb90604401611084565b600b818154811061197057600080fd5b6000918252602090912001546001600160a01b0316905081565b61199582338361295c565b6114868282612b86565b6119b7600080516020613e3d83398151915233611db0565b6119d35760405162461bcd60e51b8152600401610b6d90613c19565b60085483906001600160a01b03630100000090910481169084908316611a38578015611a115760405162461bcd60e51b8152600401610b6d906138a4565b600f5460ff16611a335760405162461bcd60e51b8152600401610b6d90613a29565b611a8e565b3415611a565760405162461bcd60e51b8152600401610b6d90613be2565b6001600160a01b0383166000908152600d602052604090205460ff16611a8e5760405162461bcd60e51b8152600401610b6d90613b7c565b6001600160a01b038216611ab45760405162461bcd60e51b8152600401610b6d90613adb565b611abd81612cc6565b611ad95760405162461bcd60e51b8152600401610b6d906139fb565b6000611af36001600160a01b038816156112335786611d1c565b905060006001600160a01b03881615611b1557611b108783612d4e565b611b1f565b611b1f3483612d4e565b90506001600160a01b038816611b755760085460405163010000009091046001600160a01b0316906108fc8415029084906000818181858888f19350505050158015611b6f573d6000803e3d6000fd5b50611c87565b6040516323b872dd60e01b81526001600160a01b038916906323b872dd90611ba5908c9030908690600401613800565b602060405180830381600087803b158015611bbf57600080fd5b505af1158015611bd3573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611bf79190613638565b506008546040516323b872dd60e01b81526001600160a01b03808b16926323b872dd92611c33928e926301000000900416908790600401613800565b602060405180830381600087803b158015611c4d57600080fd5b505af1158015611c61573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611c859190613638565b505b611c918682612d5a565b505050505050505050565b611cb4600080516020613e1d83398151915233611db0565b611d145760405162461bcd60e51b81526020600482015260376024820152600080516020613dfd83398151915260448201527f76652070617573657220726f6c6520746f2070617573650000000000000000006064820152608401610b6d565b61172d612ec7565b600854600090610aab9061271090611d3e908590610100900461ffff16612f04565b90612f10565b600c818154811061197057600080fd5b600a546001600160a01b03163314611d7e5760405162461bcd60e51b8152600401610b6d90613b1f565b600f805460ff1916911515919091179055565b6000828152600260205260408120611da99083612f1c565b9392505050565b60009182526001602090815260408084206001600160a01b0393909316845291905290205460ff1690565b606060078054610ac090613d2b565b600854600090610aab90611e0990610100900461ffff16612710613cae565b61ffff16611d3e84612710612f04565b60003381611e2782866123ac565b905083811015611e875760405162461bcd60e51b815260206004820152602560248201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f77604482015264207a65726f60d81b6064820152608401610b6d565b610e9a8286868403612788565b600033610c888185856129d0565b6060600b805480602002602001604051908101604052809291908181526020018280548015610b3957602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311611edc575050505050905090565b600a546001600160a01b03163314611f2d5760405162461bcd60e51b8152600401610b6d90613b1f565b600a80546001600160a01b0319166001600160a01b0392909216919091179055565b60085482906001600160a01b03630100000090910481169083908316611fb4578015611f8d5760405162461bcd60e51b8152600401610b6d906138a4565b600f5460ff16611faf5760405162461bcd60e51b8152600401610b6d90613a29565b61200a565b3415611fd25760405162461bcd60e51b8152600401610b6d90613be2565b6001600160a01b0383166000908152600d602052604090205460ff1661200a5760405162461bcd60e51b8152600401610b6d90613b7c565b6001600160a01b0382166120305760405162461bcd60e51b8152600401610b6d90613adb565b61203981612cc6565b6120555760405162461bcd60e51b8152600401610b6d906139fb565b600061206f6001600160a01b038716156112335785611d1c565b905060006001600160a01b038716156120915761208c8683612d4e565b61209b565b61209b3483612d4e565b90506001600160a01b0387166120fc576120b6335b82612d5a565b60085460405163010000009091046001600160a01b0316906108fc8415029084906000818181858888f193505050501580156120f6573d6000803e3d6000fd5b50612216565b6040516323b872dd60e01b81526001600160a01b038816906323b872dd9061212c90339030908690600401613800565b602060405180830381600087803b15801561214657600080fd5b505af115801561215a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061217e9190613638565b506008546040516323b872dd60e01b81526001600160a01b03898116926323b872dd926121ba9233926301000000900416908790600401613800565b602060405180830381600087803b1580156121d457600080fd5b505af11580156121e8573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061220c9190613638565b50612216336120b0565b50505050505050565b60006001600160a01b03821661223a57600f5460ff16610aab565b6001600160a01b0382166000908152600d602052604090205460ff16610aab565b919050565b600a546001600160a01b0316331461228a5760405162461bcd60e51b8152600401610b6d90613b1f565b8063ffffffff1680600954106122b25760405162461bcd60e51b8152600401610b6d906138ef565b6009546122c0906001613c55565b8111156122df5760405162461bcd60e51b8152600401610b6d9061399e565b60098190556127108361ffff16111561234f5760405162461bcd60e51b815260206004820152602c60248201527f46756e6769626c65546f6b656e577261707065723a20496e76616c696420666560448201526b652070657263656e7461676560a01b6064820152608401610b6d565b50506008805461ffff9092166101000262ffff0019909216919091179055565b6000818152600260205260408120610aab90612f28565b600082815260016020819052604090912001546123a281612e27565b6114078383612e53565b6001600160a01b03918216600090815260046020908152604080832093909416825291909152205490565b60005460ff161561242a5760405162461bcd60e51b815260206004820181905260248201527f496e697469616c697a65643a20416c726561647920696e697469616c697a65646044820152606401610b6d565b61243381612f32565b505060008054600160ff199182161790915560088054610100600160b81b03191661010061ffff98909816979097026301000000600160b81b0319169690961763010000006001600160a01b039687160217909555600a80546001600160a01b0319169390941692909217909255601091909155600f8054909216901515179055565b600a546001600160a01b031633146124e05760405162461bcd60e51b8152600401610b6d90613b1f565b601055565b600a546001600160a01b0316331461250f5760405162461bcd60e51b8152600401610b6d90613b1f565b8063ffffffff1680600954106125375760405162461bcd60e51b8152600401610b6d906138ef565b600954612545906001613c55565b8111156125645760405162461bcd60e51b8152600401610b6d9061399e565b60098190556001600160a01b0383166000908152600d602052604090205460ff16156125ea5760405162461bcd60e51b815260206004820152602f60248201527f46756e6769626c65546f6b656e577261707065723a20546f6b656e2073686f7560448201526e1b19081b9bdd081899481d985b1a59608a1b6064820152608401610b6d565b600b8054600181019091557f0175b7a638427703f0dbe7bb9bbf987a2551717b34e79f33b5b1008d1fa01db90180546001600160a01b0319166001600160a01b0385169081179091556000908152600e602052604090205460ff166126ad57600c805460018082019092557fdf6966c971051c3d54ec59162606531493a51404a002842f56009d7e5cf4a8c70180546001600160a01b0319166001600160a01b0386169081179091556000908152600e60205260409020805460ff191690911790555b50506001600160a01b03166000908152600d60205260409020805460ff19166001179055565b6126dd8282611db0565b6114865760008281526001602081815260408084206001600160a01b0386168086529252808420805460ff19169093179092559051339285917f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d9190a45050565b6000611da9836001600160a01b038416612f6f565b60006001600160e01b03198216637965db0b60e01b1480610aab57506301ffc9a760e01b6001600160e01b0319831614610aab565b6001600160a01b0383166127ea5760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b6064820152608401610b6d565b6001600160a01b03821661284b5760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b6064820152608401610b6d565b6001600160a01b0383811660008181526004602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b600b80546128bc90600190613cd1565b815481106128cc576128cc613dad565b600091825260209091200154600b80546001600160a01b0390921691839081106128f8576128f8613dad565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b03160217905550600b80548061293757612937613d97565b600082815260209020810160001990810180546001600160a01b031916905501905550565b600061296884846123ac565b90506000198114610e7b57818110156129c35760405162461bcd60e51b815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e63650000006044820152606401610b6d565b610e7b8484848403612788565b6001600160a01b038316612a345760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b6064820152608401610b6d565b6001600160a01b038216612a965760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b6064820152608401610b6d565b612aa1838383612fbe565b6001600160a01b03831660009081526003602052604090205481811015612b195760405162461bcd60e51b815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e7420657863656564732062604482015265616c616e636560d01b6064820152608401610b6d565b6001600160a01b0380851660008181526003602052604080822086860390559286168082529083902080548601905591517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef90612b799086815260200190565b60405180910390a3610e7b565b6001600160a01b038216612be65760405162461bcd60e51b815260206004820152602160248201527f45524332303a206275726e2066726f6d20746865207a65726f206164647265736044820152607360f81b6064820152608401610b6d565b612bf282600083612fbe565b6001600160a01b03821660009081526003602052604090205481811015612c665760405162461bcd60e51b815260206004820152602260248201527f45524332303a206275726e20616d6f756e7420657863656564732062616c616e604482015261636560f01b6064820152608401610b6d565b6001600160a01b03831660008181526003602090815260408083208686039055600580548790039055518581529192917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a3505050565b6000601054306001600160a01b03166318160ddd6040518163ffffffff1660e01b815260040160206040518083038186803b158015612d0457600080fd5b505afa158015612d18573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612d3c9190613772565b612d469084613c55565b111592915050565b6000611da98284613cd1565b6001600160a01b038216612db05760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f2061646472657373006044820152606401610b6d565b612dbc60008383612fbe565b8060056000828254612dce9190613c55565b90915550506001600160a01b0382166000818152600360209081526040808320805486019055518481527fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a35050565b6117b48133612fc9565b612e3b82826126d3565b6000828152600260205260409020611407908261273e565b612e5d8282613022565b60008281526002602052604090206114079082613089565b612e7d61309e565b6008805460ff191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b612ecf6130e7565b6008805460ff191660011790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a258612eaa3390565b6000611da98284613c8f565b6000611da98284613c6d565b6000611da9838361312d565b6000610aab825490565b6000612f4c600080516020613e3d83398151915283613157565b612f57600083613157565b61225b600080516020613e1d83398151915283613157565b6000818152600183016020526040812054612fb657508154600181810184556000848152602080822090930184905584548482528286019093526040902091909155610aab565b506000610aab565b611407838383613161565b612fd38282611db0565b61148657612fe0816131c7565b612feb8360206131d9565b604051602001612ffc92919061378b565b60408051601f198184030181529082905262461bcd60e51b8252610b6d91600401613871565b61302c8282611db0565b156114865760008281526001602090815260408083206001600160a01b0385168085529252808320805460ff1916905551339285917ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b9190a45050565b6000611da9836001600160a01b038416613375565b60085460ff1661172d5760405162461bcd60e51b815260206004820152601460248201527314185d5cd8589b194e881b9bdd081c185d5cd95960621b6044820152606401610b6d565b60085460ff161561172d5760405162461bcd60e51b815260206004820152601060248201526f14185d5cd8589b194e881c185d5cd95960821b6044820152606401610b6d565b600082600001828154811061314457613144613dad565b9060005260206000200154905092915050565b6114868282612e31565b60085460ff16156114075760405162461bcd60e51b815260206004820152602a60248201527f45524332305061757361626c653a20746f6b656e207472616e736665722077686044820152691a5b19481c185d5cd95960b21b6064820152608401610b6d565b6060610aab6001600160a01b03831660145b606060006131e8836002613c8f565b6131f3906002613c55565b67ffffffffffffffff81111561320b5761320b613dc3565b6040519080825280601f01601f191660200182016040528015613235576020820181803683370190505b509050600360fc1b8160008151811061325057613250613dad565b60200101906001600160f81b031916908160001a905350600f60fb1b8160018151811061327f5761327f613dad565b60200101906001600160f81b031916908160001a90535060006132a3846002613c8f565b6132ae906001613c55565b90505b6001811115613326576f181899199a1a9b1b9c1cb0b131b232b360811b85600f16601081106132e2576132e2613dad565b1a60f81b8282815181106132f8576132f8613dad565b60200101906001600160f81b031916908160001a90535060049490941c9361331f81613d14565b90506132b1565b508315611da95760405162461bcd60e51b815260206004820181905260248201527f537472696e67733a20686578206c656e67746820696e73756666696369656e746044820152606401610b6d565b6000818152600183016020526040812054801561345e576000613399600183613cd1565b85549091506000906133ad90600190613cd1565b90508181146134125760008660000182815481106133cd576133cd613dad565b90600052602060002001549050808760000184815481106133f0576133f0613dad565b6000918252602080832090910192909255918252600188019052604090208390555b855486908061342357613423613d97565b600190038181906000526020600020016000905590558560010160008681526020019081526020016000206000905560019350505050610aab565b6000915050610aab565b803561ffff8116811461225b57600080fd5b803563ffffffff8116811461225b57600080fd5b6000602082840312156134a057600080fd5b8135611da981613dd9565b600080604083850312156134be57600080fd5b82356134c981613dd9565b91506134d76020840161347a565b90509250929050565b600080604083850312156134f357600080fd5b82356134fe81613dd9565b9150602083013561350e81613dd9565b809150509250929050565b60008060006060848603121561352e57600080fd5b833561353981613dd9565b9250602084013561354981613dd9565b929592945050506040919091013590565b6000806000806080858703121561357057600080fd5b843561357b81613dd9565b9350602085013561358b81613dd9565b92506040850135915060608501356135a281613dd9565b939692955090935050565b600080604083850312156135c057600080fd5b82356135cb81613dd9565b946020939093013593505050565b6000806000606084860312156135ee57600080fd5b83356135f981613dd9565b925060208401359150604084013561361081613dd9565b809150509250925092565b60006020828403121561362d57600080fd5b8135611da981613dee565b60006020828403121561364a57600080fd5b8151611da981613dee565b60006020828403121561366757600080fd5b5035919050565b6000806040838503121561368157600080fd5b82359150602083013561350e81613dd9565b600080604083850312156136a657600080fd5b50508035926020909101359150565b6000602082840312156136c757600080fd5b81356001600160e01b031981168114611da957600080fd5b60008060008060008060c087890312156136f857600080fd5b61370187613468565b9550602087013561371181613dd9565b9450604087013561372181613dd9565b935060608701359250608087013561373881613dee565b915060a087013561374881613dd9565b809150509295509295509295565b6000806040838503121561376957600080fd5b6134c983613468565b60006020828403121561378457600080fd5b5051919050565b7f416363657373436f6e74726f6c3a206163636f756e74200000000000000000008152600083516137c3816017850160208801613ce8565b7001034b99036b4b9b9b4b733903937b6329607d1b60179184019182015283516137f4816028840160208801613ce8565b01602801949350505050565b6001600160a01b039384168152919092166020820152604081019190915260600190565b6020808252825182820181905260009190848201906040850190845b818110156138655783516001600160a01b031683529284019291840191600101613840565b50909695505050505050565b6020815260008251806020840152613890816040850160208701613ce8565b601f01601f19169190910160400192915050565b6020808252602b908201527f496e76616c696420616d6f756e742070726f766964656420666f72206e61746960408201526a7665207772617070696e6760a81b606082015260800190565b60208082526023908201527f50726f706f73616c4e6f6e6365547261636b65723a20496e76616c6964206e6f6040820152626e636560e81b606082015260800190565b6020808252601b908201527f496e73756666696369656e74206e61746976652062616c616e63650000000000604082015260600190565b6020808252818101527f496e76616c696420686973746f726963616c20746f6b656e2061646472657373604082015260600190565b6020808252603a908201527f50726f706f73616c4e6f6e6365547261636b65723a204e6f6e6365206d75737460408201527f206e6f7420696e6372656d656e74206d6f7265207468616e2031000000000000606082015260800190565b602080825260149082015273125b9d985b1a59081d1bdad95b88185b5bdd5b9d60621b604082015260600190565b60208082526035908201527f4e6174697665207772617070696e67206973206e6f7420616c6c6f776564206660408201527437b9103a3434b9903a37b5b2b7103bb930b83832b960591b606082015260800190565b60208082526037908201527f4e617469766520756e7772617070696e67206973206e6f7420616c6c6f77656460408201527f20666f72207468697320746f6b656e2077726170706572000000000000000000606082015260800190565b60208082526024908201527f46656520526563697069656e742063616e6e6f74206265207a65726f206164646040820152637265737360e01b606082015260800190565b60208082526039908201527f46756e6769626c65546f6b656e577261707065723a204f6e6c792068616e646c60408201527f65722063616e2063616c6c20746869732066756e6374696f6e00000000000000606082015260800190565b602080825260159082015274496e76616c696420746f6b656e206164647265737360581b604082015260600190565b6020808252601a908201527f496e73756666696369656e742045524332302062616c616e6365000000000000604082015260600190565b6020808252601f908201527f496e76616c69642076616c75652073656e7420666f72207772617070696e6700604082015260600190565b6020808252602e90820152600080516020613dfd83398151915260408201526d7665206d696e74657220726f6c6560901b606082015260800190565b60008219821115613c6857613c68613d81565b500190565b600082613c8a57634e487b7160e01b600052601260045260246000fd5b500490565b6000816000190483118215151615613ca957613ca9613d81565b500290565b600061ffff83811690831681811015613cc957613cc9613d81565b039392505050565b600082821015613ce357613ce3613d81565b500390565b60005b83811015613d03578181015183820152602001613ceb565b83811115610e7b5750506000910152565b600081613d2357613d23613d81565b506000190190565b600181811c90821680613d3f57607f821691505b60208210811415613d6057634e487b7160e01b600052602260045260246000fd5b50919050565b6000600019821415613d7a57613d7a613d81565b5060010190565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052603160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052604160045260246000fd5b6001600160a01b03811681146117b457600080fd5b80151581146117b457600080fdfe45524332305072657365744d696e7465725061757365723a206d75737420686165d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a6a2646970667358221220490f6eccd4732f14361eeb04b012abb925b17429475370c7aa86600d4abdf69a64736f6c63430008050033".as_bytes().into_iter().cloned().collect::<Vec<u8>>().into();
    let factory =
        ContractFactory::new(token_one.abi().clone(), bytecode, provider);
    dbg!(&token_one.abi().constructor().unwrap().inputs);
    let params = Token::Tuple(vec![
        Token::String("WETH".to_string()),
        Token::String("WETH".to_string()),
    ]);

    // TODO: fails with "Out of gas: required gas exceeds allowance"
    // could be https://github.com/foundry-rs/foundry/issues/3862 ?
    factory.deploy(params).unwrap().send().await.unwrap();

    token_one
        .mint(governor_wallet.address(), parse_ether(1).unwrap())
        .call()
        .await
        .unwrap();
    dbg!(token_one
        .balance_of(governor_wallet.address())
        .call()
        .await
        .unwrap());


    // TODO: deploy vbridge with tokens

    /*
    let config = WebbRelayerConfig {
        port: chain_one.1.socket_address().port(),
        evm: Default::default(),
        substrate: Default::default(),
        experimental: Default::default(),
        features: Default::default(),
    };
    let store = create_store(&Opts::default()).await.unwrap();
    let ctx = RelayerContext::new(config, store);

    let command = EvmVanchorCommand{
        chain_id: chain_one.0.chain_id(),
        id: Address::default(),
        proof_data: ProofData::default(),
        ext_data: ExtData::default(),
    };
    let (my_tx, my_rx) = mpsc::channel(50);

    handle_vanchor_relay_tx(ctx, command, my_tx).await.unwrap();
    */
}
